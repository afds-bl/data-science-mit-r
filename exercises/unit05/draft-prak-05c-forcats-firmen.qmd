---
title: "Praktikum 5c: `{forcats}`"
date: last-modified
format: html
---

# Tastaturkürzel

|  |  |
|---------------------------------------------------|---------------------|
| Einen neuen Code-chunk hinzufügen | `Ctrl + Alt + I` |
| Code "Zeile für Zeile" innerhalb eines Code-chunks ausführen | `Ctrl + Enter` |
| Den gesamten Code-chunk ausführen | `Ctrl + Shift + Enter` |
| (Aus-)kommentieren | `Ctrl + Shift + C` |
| Das Pipe `|>` | `Ctrl + Shift + M` |
| Der Zuweisungs-Operator `<-` | `Alt + -` |

# Packages laden

```{r}
library(janitor)
library(tidyverse)
```


# Daten laden

[Tägliche Meldungen](https://data.bl.ch/explore/dataset/12460/) aus dem Schweizerischen Handelsamtsblatt (SHAB). Eingetragen und im SHAB veröffentlicht werden rechtlich verbindliche Tatsachen vorab bei privaten Rechtssubjekten.

```{r}
df <- read_csv("data/ogd_12460_firmen_clean.csv")
df_raum <- read_delim("data/ogd-10110-raumgliederung.csv", delim = ";") |> 
  clean_names()
```
    

- Erkundet die Daten mit `glimpse()` und `summary()`.

```{r}
df |> glimpse()
```

```{r}
df_raum |> glimpse()
```

# Daten transformieren

```{r}
df |> count(rechtsform, sort = TRUE)
```

```{r}
df <- df |> 
  left_join(df_raum, join_by(firmensitz_code == bfs_nummer, firmensitz == gemeinde)) |> 
  filter(jahr != 2025) |> 
  mutate(rechtsform_gruppiert = fct_lump(rechtsform, n = 3, other_level = "Anders"))

df |> count(rechtsform_gruppiert, rechtsform, sort = TRUE)
```

# Daten visualisieren

```{r}
df |> 
  mutate(
    rechtsform_gruppiert = fct_rev(fct_infreq(rechtsform_gruppiert)),
    jahr = factor(jahr)) |> 
  ggplot(aes(x = jahr, fill = rechtsform_gruppiert)) +
  geom_bar()
```

```{r}
df |> 
  mutate(
    rechtsform_gruppiert = fct_infreq(rechtsform_gruppiert),
    jahr = factor(jahr)) |> 
  mutate(bezirk = fct_infreq(bezirk)) |> 
  ggplot(aes(x = jahr, fill = rechtsform_gruppiert)) +
  geom_bar() +
  facet_grid(rechtsform_gruppiert ~ bezirk) +
  theme_minimal() +
  labs(
    x = "",
    y = "Anzahl",
    fill = "Rechtsform",
    title = "Rechtsform der gemeldeten Firmen pro Bezirk in BL",
    caption = "Quelle: https://data.bl.ch/explore/dataset/12460/"
  ) +
  theme(legend.position = "none")
```


